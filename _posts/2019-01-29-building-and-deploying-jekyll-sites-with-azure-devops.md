---
layout: post
title: 'Building and Deploying Jekyll Sites with Azure DevOps and Azure Storage Static Site Hosting'
tags: [AzureDevOps, CICD]
featured_image_thumbnail: /assets/images/posts/2019/jekyll-build/header_thumb.jpg
featured_image: /assets/images/posts/2019/jekyll-build/header.jpg
---

When I decided to get back into blogging after having ditched my previous effort a few years back, I had two initial thoughts.  First, I wanted to take a look at options were available for blogging platforms.  Second, I wanted to start my post off with something more interesting than the obligatory "here's how I built my blog" post.  Well, as of this post, I'm 1 for 2 in those goals as I'm about to run you through how I'm deploying and hosting my shiny new blog using <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>, <a href="https://azure.microsoft.com/en-us/services/devops/" target="_blank">Azure DevOps</a> and <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website" target="_blank">Azure Static Website Hosting</a>.
# Hosting Options
Before I retired my previous blog, I was using <a href="https://wordpress.com/" target="_blank">WordPress</a> on a VPS host.  Despite having absolutely zero PHP experience, this worked out pretty well for me.  It was intuitive to setup and easy to configure to meet my fairly minimal needs.  One of my desires with my new blog was to host it on <a href="https://azure.microsoft.com/" target="_blank">Microsoft Azure</a>, since my day job involves helping Microsoft's customers build great things on Azure.  It turns out there are two options for running WordPress in Azure.  First, there's an option in the <a href="https://azure.microsoft.com/en-us/blog/how-to-host-a-scalable-and-optimized-wordpress-for-azure-in-minutes/" target="_blank">Azure Marketplace</a> that provisions WordPress on Azure App Service, Azure Storage and hosted MySQL.  This is a super easy way to get WordPress up and running on top of highly scalable PaaS services.  The other option would be to provision one or more virtual machines and install WordPress and it's dependencies yourself.  There's obviously trade offs to both of these approaches, but for me, since I'm paying for hosting myself, and, let's face it, I'm pretty cheap, both of these options are out of my budget.

Another option I considered is <a href="https://ghost.org/" target="_blank">Ghost</a>.  Ghost is really appealing to me because it's built on NodeJS, something I have at least some experience with.  Ghost could easily be hosted on a VM in Azure, and while there isn't an official Ghost offering in the Azure Marketplace, a quick search will show that there are at least a few options for running on Azure App Service.  Again, like with WordPress, both of these hosting options are have their place, but for me, they're outside of my budget.
## Static Site Generators
One drawback of platforms such as WordPress and Ghost is the dependency they have on their database and server-side frameworks.  To ensure we stay ahead of security vulnerabilities, we need to stay on top of new releases and security patches for things like PHP, our database and any dependent libraries.  With this in mind, and considering that a CMS like WordPress or Ghost really brings along a lot more capabilities than I really need, I was interested in exploring static site generators as an option for blogging.

For the uninitiated, a static site generator is a tool that takes static content and a set of templates as input and outputs plain old HTML, images, JavaScript and CSS.  This means that when it comes to serving your site, you don't need any server-side frameworks or databases.  You simply need a web server to serve that static content.  There are a number of different static site generators available, but I investigated two in particular, based on the recommendation of colleagues.  
### GatsbyJS
<a href="https://www.gatsbyjs.org" target="_blank">GatsbyJS</a> is a static site generator based on React.  At this point, I should disclose that I am not now, nor do I aspire to become a front-end developer.  Unfortunately, it was on this point that GatsbyJS lost me.  Browsing through their documentation, it pretty quickly got into writing GraphQL queries and editing markup.  I'm sure GatsbyJS is a fine framework and that there are templates available that minimize the need to learn things like React and GraphQL, but based on what I saw in their docs, I decided to move on to another option.
### Jekyll
The next, and as it turns out, final option I looked at is <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>.  Jekyll is based on Ruby and takes markdown as input.  Within about 10 minutes, I was able to spin up a Jekyll based site locally.  That includes the time to find a custom theme and downloading/installing Ruby on my Windows laptop.  Based on this experience, Jekyll absolutely met my unspoken laziness requirement, that is, not having to learn a whole new tech stack to spin up a blog.
# Hosting a Jekyll Blog
Chances are, if you're familiar with Jekyll, it's in the context of hosting content on <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.  If you're not familiar with GitHub Pages, it's an awesome, and easy way to host static content out of a GitHub repository.  What's even better, if your repo has a Jekyll site in it, GitHub will trigger a Jekyll build and deploy your static content based on commits to your repo.  As if all of that isn't awesome enough, GitHub Pages also supports using your own custom domain and HTTPS.  HTTPS leverages <a href="https://letsencrypt.org/" target="_blank">Let's Encrypt</a> and GitHub Pages takes care of automating the request and renewal of your cert.  Oh, and did I mention that all of this, hosting, building and HTTPS is free?  Pretty awesome, right?  Unfortunately, there's one limitation to hosting Jekyll on GitHub pages that caused me to look elsewhere for hosting.  It turns out that for building Jekyll sites, GitHub Pages has a <a href="https://pages.github.com/versions/" target="_blank">pre-defined list of Jekyll plugins</a> that are supported.  Unfortunately, it turns out that the theme I'm using has at least one plugin that isn't currently supported by GitHub.  Of course I could have ditched the theme and found a different one, but I'll be honest, I kind of liked the way it looked, and I was curious about exploring another specific hosting option, <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website" target="_blank">Static Website Hosting in Azure Storage.</a>
# Azure Storage Static Website Hosting
If you haven't looked at Static Website Hosting in Azure Storage, it's a super easy way to serve static content out of a Blob Storage container.  Once you enable it, you can upload HTML, images, CSS and JavaScript to a special container in your storage account.  You'll get special URL for your container that can be used to access your content via HTTP and can then put a CDN in front of it or something similar.  

Enabling this feature in your storage account couldn't be simpler.  To enable through the Azure portal, just navigate to your storage account and find the Static website option.  You'll see a toggle switch that will allow you to enable the feature.  Once enabled, you'll have the option to set a default document and error document name as you can see below.
![Azure Storage Static Website Hosting Configuration](/assets/images/posts/2019/jekyll-build/static-site-settings.jpg)

Once you have your static website setup, you'll probably want to add a custom domain and HTTPS to your site.  Adding a custom domain is accomplished by setting up a CNAME record with your DNS provider that points to the HTTP endpoint for your static site.  SSL is a bit trickier.  Your storage account and the HTTP endpoint have a certificate associated with them out of the box, however it's a wildcard certificate provided by Azure for *.web.core.windows.net.  This means that if you use a custom domain, you need a way to also have a certificate that matches your domain name.  The Static Website feature itself doesn't actually support this, however placing Azure CDN in front of your storage account's HTTPS endpoint will allow you to easily add a certificate that matches your custom domain name.  In fact, Azure CDN gives you an option to bring your own certificate or to let Azure provision and manage the certificate lifecycle for you.
